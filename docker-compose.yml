version: '3.8'

services:
  gateway:
    build: .
    ports:
      - "4020:4020"
    environment:
      - GATEWAY_PORT=4020
      - GATEWAY_HOST=0.0.0.0
      - GATEWAY_UPSTREAM=http://host.docker.internal:3000
      - GATEWAY_PAYMENT_ADDRESS=${GATEWAY_PAYMENT_ADDRESS}
      - GATEWAY_DEFAULT_PRICE=${GATEWAY_DEFAULT_PRICE:-0.1}
      - GATEWAY_RPC=${GATEWAY_RPC:-https://rpc2.neutaro.io}
      - GATEWAY_REST=${GATEWAY_REST:-https://api2.neutaro.io}
      - GATEWAY_MIN_CONFIRMATIONS=${GATEWAY_MIN_CONFIRMATIONS:-1}
      - GATEWAY_INVOICE_TTL=${GATEWAY_INVOICE_TTL:-300}
      - GATEWAY_PREPAID=${GATEWAY_PREPAID:-false}
      - GATEWAY_DB=/app/data/gateway.db
    volumes:
      - gateway-data:/app/data
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:4020/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  gateway-data: